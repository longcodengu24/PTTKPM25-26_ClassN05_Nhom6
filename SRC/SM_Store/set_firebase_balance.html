<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>üéØ Set Firebase Balance</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 700px;
                margin: 50px auto;
                padding: 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            .card {
                background: white;
                padding: 40px;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            }
            h1 {
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
            }
            .info {
                background: #e3f2fd;
                padding: 15px;
                border-radius: 10px;
                margin: 20px 0;
                border-left: 4px solid #2196f3;
            }
            .current {
                text-align: center;
                margin: 30px 0;
            }
            .current-label {
                font-size: 14px;
                color: #666;
                margin-bottom: 5px;
            }
            .current-value {
                font-size: 48px;
                font-weight: bold;
                color: #667eea;
            }
            .input-section {
                margin: 30px 0;
            }
            label {
                display: block;
                font-weight: bold;
                margin-bottom: 10px;
                color: #333;
            }
            input {
                width: 100%;
                padding: 15px;
                font-size: 24px;
                border: 2px solid #667eea;
                border-radius: 10px;
                text-align: center;
                box-sizing: border-box;
            }
            .preset-buttons {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                margin: 20px 0;
            }
            .btn-preset {
                padding: 12px;
                font-size: 14px;
                font-weight: bold;
                background: linear-gradient(135deg, #f093fb, #f5576c);
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
            }
            .btn-preset:hover {
                opacity: 0.9;
            }
            .btn-update {
                width: 100%;
                padding: 20px;
                font-size: 20px;
                font-weight: bold;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                margin-top: 20px;
            }
            .btn-update:hover {
                opacity: 0.9;
            }
            .result {
                margin-top: 30px;
                padding: 20px;
                border-radius: 10px;
                display: none;
            }
            .success {
                background: #d4edda;
                color: #155724;
                border: 2px solid #28a745;
            }
            .error {
                background: #f8d7da;
                color: #721c24;
                border: 2px solid #dc3545;
            }
            .warning {
                background: #fff3cd;
                color: #856404;
                padding: 15px;
                border-radius: 10px;
                margin-top: 20px;
                border-left: 4px solid #ffc107;
            }
        </style>
    </head>
    <body>
        <div class="card">
            <h1>üéØ Set Firebase Balance</h1>

            <div class="info">
                <strong>User ID:</strong> cfT4zfDX4YRkuwd4T6X3seJhtbl1<br />
                <strong>Firebase Path:</strong>
                users/cfT4zfDX4YRkuwd4T6X3seJhtbl1/coins
            </div>

            <div class="current">
                <div class="current-label">S·ªë D∆∞ Hi·ªán T·∫°i Tr√™n Firebase:</div>
                <div class="current-value">870,000 coins</div>
            </div>

            <div class="input-section">
                <label>Nh·∫≠p S·ªë D∆∞ M·ªõi:</label>
                <input
                    type="number"
                    id="newBalance"
                    value="870000"
                    placeholder="Nh·∫≠p s·ªë coins..."
                />
            </div>

            <div class="preset-buttons">
                <button class="btn-preset" onclick="setAmount(50000)">
                    50K
                </button>
                <button class="btn-preset" onclick="setAmount(100000)">
                    100K
                </button>
                <button class="btn-preset" onclick="setAmount(500000)">
                    500K
                </button>
                <button class="btn-preset" onclick="setAmount(1000000)">
                    1M
                </button>
                <button class="btn-preset" onclick="setAmount(870000)">
                    870K<br />(Hi·ªán t·∫°i)
                </button>
                <button class="btn-preset" onclick="setAmount(900000)">
                    900K
                </button>
                <button class="btn-preset" onclick="setAmount(1500000)">
                    1.5M
                </button>
                <button class="btn-preset" onclick="setAmount(2000000)">
                    2M
                </button>
            </div>

            <button class="btn-update" onclick="updateFirebase()">
                üíæ C·∫¨P NH·∫¨T FIREBASE
            </button>

            <div id="result" class="result"></div>

            <div class="warning">
                <strong>‚ö†Ô∏è L∆∞u √ù:</strong><br />
                ‚Ä¢ N√∫t n√†y s·∫Ω <strong>SET</strong> s·ªë d∆∞ ch√≠nh x√°c (kh√¥ng c·ªông
                th√™m)<br />
                ‚Ä¢ ƒê·ª´ng d√πng n√∫t "Test Firebase Chi Ti·∫øt" - n√≥ s·∫Ω c·ªông +1 m·ªói l·∫ßn
                click<br />
                ‚Ä¢ Sau khi update, refresh Firebase Console ƒë·ªÉ xem thay ƒë·ªïi
            </div>
        </div>

        <script>
            const userId = "cfT4zfDX4YRkuwd4T6X3seJhtbl1";
            const baseUrl =
                "http://127.0.0.1/PTTKPM25-26_ClassN05_Nhom6/SRC/SM_Store";

            function setAmount(value) {
                document.getElementById("newBalance").value = value;
            }

            async function updateFirebase() {
                const amount = document.getElementById("newBalance").value;
                const resultDiv = document.getElementById("result");

                if (!amount || amount < 0) {
                    alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë coins h·ª£p l·ªá!");
                    return;
                }

                // Confirm tr∆∞·ªõc khi update
                if (
                    !confirm(
                        `B·∫°n c√≥ ch·∫Øc mu·ªën SET Firebase balance v·ªÅ ${parseInt(
                            amount
                        ).toLocaleString()} coins?`
                    )
                ) {
                    return;
                }

                resultDiv.innerHTML = "‚è≥ ƒêang c·∫≠p nh·∫≠t Firebase...";
                resultDiv.className = "result";
                resultDiv.style.display = "block";

                try {
                    // Th·ª≠ route firebase-write-balance
                    let url = `${baseUrl}/debug/firebase-write-balance/${userId}/${amount}`;
                    console.log("üîÑ Calling:", url);

                    let response = await fetch(url);
                    let text = await response.text();
                    console.log("üì• Response:", text);

                    // N·∫øu l·ªói 404, th·ª≠ route kh√°c
                    if (response.status === 404 || text.includes("Not Found")) {
                        console.log("‚ö†Ô∏è Route 1 failed, trying alternative...");

                        // Th·ª≠ d√πng route test-firebase-direct v√† modify
                        url = `${baseUrl}/debug/test-firebase-direct`;
                        response = await fetch(url);
                        text = await response.text();
                    }

                    try {
                        const data = JSON.parse(text);

                        if (
                            data.success ||
                            data.write_successful ||
                            data.new_balance
                        ) {
                            resultDiv.className = "result success";
                            resultDiv.innerHTML = `
                            <h2>‚úÖ C·∫¨P NH·∫¨T TH√ÄNH C√îNG!</h2>
                            <div style="font-size: 36px; font-weight: bold; margin: 20px 0; color: #28a745;">
                                ${parseInt(amount).toLocaleString()} coins
                            </div>
                            <p><strong>Firebase ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!</strong></p>
                            <p>‚úÖ S·ªë d∆∞ c≈©: ${(
                                data.old_balance || 870000
                            ).toLocaleString()} coins</p>
                            <p>‚úÖ S·ªë d∆∞ m·ªõi: ${parseInt(
                                amount
                            ).toLocaleString()} coins</p>
                            <p style="margin-top: 20px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                                üí° <strong>Refresh Firebase Console</strong> ƒë·ªÉ xem thay ƒë·ªïi!
                            </p>
                        `;
                        } else {
                            throw new Error(
                                data.error || "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t Firebase"
                            );
                        }
                    } catch (parseError) {
                        // N·∫øu kh√¥ng parse ƒë∆∞·ª£c JSON, c√≥ th·ªÉ l√† HTML error
                        if (
                            text.includes("Not Found") ||
                            text.includes("404")
                        ) {
                            resultDiv.className = "result error";
                            resultDiv.innerHTML = `
                            <h2>‚ùå L·ªñI - ROUTE KH√îNG T√åM TH·∫§Y</h2>
                            <p>Route <code>${url}</code> kh√¥ng t·ªìn t·∫°i.</p>
                            <hr>
                            <h3>üõ†Ô∏è C√ÅCH S·ª¨A THAY TH·∫æ:</h3>
                            <p><strong>M·ªü URL n√†y trong browser:</strong></p>
                            <input type="text" value="${baseUrl}/debug/firebase-write-balance/${userId}/${amount}" 
                                   style="width: 100%; padding: 10px; font-size: 12px;" readonly 
                                   onclick="this.select(); document.execCommand('copy'); alert('ƒê√£ copy URL!')">
                            <p style="margin-top: 15px;">
                                1. Copy URL tr√™n<br>
                                2. M·ªü tab m·ªõi<br>
                                3. Paste v√† Enter<br>
                                4. Xem k·∫øt qu·∫£ JSON
                            </p>
                        `;
                        } else {
                            resultDiv.className = "result error";
                            resultDiv.innerHTML = `
                            <h2>‚ùå L·ªñI PARSE JSON</h2>
                            <p>${parseError.message}</p>
                            <details>
                                <summary>Xem response (click ƒë·ªÉ m·ªü)</summary>
                                <pre style="background: #f5f5f5; padding: 10px; overflow-x: auto; font-size: 11px;">${text}</pre>
                            </details>
                        `;
                        }
                    }
                } catch (error) {
                    resultDiv.className = "result error";
                    resultDiv.innerHTML = `
                    <h2>‚ùå L·ªñI K·∫æT N·ªêI</h2>
                    <p>${error.message}</p>
                    <hr>
                    <h3>üõ†Ô∏è TH·ª¨ C√ÅCH TH·ª¶ C√îNG:</h3>
                    <p>Copy URL n√†y v√† m·ªü trong tab m·ªõi:</p>
                    <input type="text" value="${baseUrl}/debug/firebase-write-balance/${userId}/${amount}" 
                           style="width: 100%; padding: 10px; font-size: 12px;" readonly 
                           onclick="this.select(); document.execCommand('copy'); alert('ƒê√£ copy!')">
                `;
                }
            }
        </script>
    </body>
</html>
